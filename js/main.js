function initTheme(){const e=document.querySelector(".theme-toggle"),t=document.querySelector(".theme-toggle i");e.removeAttribute("title");"true"===localStorage.getItem("darkMode")?(document.body.classList.add("dark-mode"),document.documentElement.classList.add("dark-mode"),t.classList.remove("fa-sun"),t.classList.add("fa-moon"),e.setAttribute("data-tooltip","切换为浅色模式")):(document.body.classList.remove("dark-mode"),document.documentElement.classList.remove("dark-mode"),t.classList.remove("fa-moon"),t.classList.add("fa-sun"),e.setAttribute("data-tooltip","切换为深色模式")),e.addEventListener("click",(function(){document.body.classList.toggle("dark-mode"),document.documentElement.classList.toggle("dark-mode"),document.body.classList.contains("dark-mode")?(t.classList.remove("fa-sun"),t.classList.add("fa-moon"),localStorage.setItem("darkMode","true"),e.setAttribute("data-tooltip","切换为浅色模式")):(t.classList.remove("fa-moon"),t.classList.add("fa-sun"),localStorage.setItem("darkMode","false"),e.setAttribute("data-tooltip","切换为深色模式"))}))}function initMobileMenu(){const e=document.querySelector(".menu-btn"),t=document.querySelector(".nav-links");e.addEventListener("click",(function(){t.classList.toggle("show");document.querySelectorAll(".bar").forEach((e=>e.classList.toggle("active")))}));document.querySelectorAll(".nav-links a").forEach((e=>{e.addEventListener("click",(function(){t.classList.remove("show");document.querySelectorAll(".bar").forEach((e=>e.classList.remove("active")))}))}))}function initProjectFilters(){const e=document.querySelectorAll(".filter-btn"),t=document.querySelectorAll(".card[data-category]");e.forEach((o=>{o.addEventListener("click",(function(){e.forEach((e=>e.classList.remove("active"))),this.classList.add("active");const o=this.getAttribute("data-filter");t.forEach((e=>{"all"===o||e.getAttribute("data-category")===o?e.style.display="block":e.style.display="none"}))}))}))}function initContactForm(){const e=document.getElementById("contactForm"),t=e.querySelector('button[type="submit"]'),o="form_submissions";e.addEventListener("submit",(function(n){if(n.preventDefault(),!function(){const e=Date.now(),t=JSON.parse(localStorage.getItem(o))||{count:0,firstSubmissionTime:null};return t.firstSubmissionTime&&e-t.firstSubmissionTime>864e5?(localStorage.removeItem(o),!0):t.count<3}())return void alert("太频繁啦！请改天再试。\n或直接联系：dayuncloud@qq.com");if("undefined"==typeof emailjs)return void alert("发送服务暂时不可用，请直接联系邮箱：dayuncloud@qq.com");const i=t.textContent;t.textContent="发送中...",t.disabled=!0;const s=setTimeout((()=>{t.textContent=i,t.disabled=!1,alert("发送超时，请直接联系邮箱：dayuncloud@qq.com")}),15e3);let a=0;!function n(){emailjs.sendForm("service_0b5rod8","template_uofl1lf",e).then((()=>{clearTimeout(s),function(){const e=Date.now(),t=JSON.parse(localStorage.getItem(o))||{count:0,firstSubmissionTime:null};t.firstSubmissionTime||(t.firstSubmissionTime=e),t.count++,localStorage.setItem(o,JSON.stringify(t))}(),alert("消息已发送成功！我会尽快回复您。"),e.reset()})).catch((e=>{if(a<2)return a++,void setTimeout(n,1e3);clearTimeout(s),alert("发送失败，请刷新重试或直接联系邮箱：dayuncloud@qq.com")})).finally((()=>{(a>=2||0===a)&&(t.textContent=i,t.disabled=!1)}))}()}))}function initAnimations(){function e(){document.querySelectorAll("[data-aos]").forEach((e=>{(function(e){const t=e.getBoundingClientRect(),o=window.innerHeight||document.documentElement.clientHeight;return t.top<=o+100})(e)&&(e.classList.contains("aos-animate")||e.classList.add("aos-animate"))}))}let t;if(setTimeout(e,100),window.addEventListener("scroll",(function(){t&&clearTimeout(t),t=setTimeout(e,50)})),"MutationObserver"in window){new MutationObserver((function(t){let o=!1;t.forEach((function(e){e.addedNodes.length>0&&(o=!0)})),o&&setTimeout(e,100)})).observe(document.body,{childList:!0,subtree:!0})}return"undefined"!=typeof AOS&&AOS.init({offset:0,delay:0,duration:700,easing:"ease-out",once:!1,mirror:!1,anchorPlacement:"top-bottom",throttleDelay:50,threshold:0}),window.addEventListener("resize",e),{refresh:e}}function initEmailFeature(){const e=document.querySelectorAll(".email-icon"),t=document.querySelector(".email-tooltip"),o=document.querySelector(".copy-btn");document.querySelector(".email-address").textContent;e.forEach((e=>{e.addEventListener("click",(function(o){o.preventDefault(),t.classList.toggle("show"),document.addEventListener("click",(function o(n){t.contains(n.target)||e.contains(n.target)||(t.classList.remove("show"),document.removeEventListener("click",o))}))}))})),o.addEventListener("click",(()=>{const e=document.querySelector(".email-address").textContent;navigator.clipboard.writeText(e).then((()=>{o.textContent="已复制",o.classList.add("copied"),setTimeout((()=>{o.textContent="复制",o.classList.remove("copied")}),2e3)})).catch((()=>{alert("复制失败，请手动选择文本复制")}))}))}function initBackToTop(){const e=document.querySelector(".back-to-top");let t,o=!1,n=!1;function i(){e.style.transform="",e.style.boxShadow=""}e.querySelector("i");e.addEventListener("mouseenter",(function(){o=!0,e.classList.remove("fade")})),e.addEventListener("mouseleave",(function(){o=!1,i(),window.scrollY>window.innerHeight&&(clearTimeout(t),t=setTimeout((()=>{o||n||e.classList.add("fade")}),2e3))})),window.addEventListener("scroll",(function(){window.scrollY>window.innerHeight?(e.classList.add("show"),e.classList.remove("fade"),o||n||(clearTimeout(t),t=setTimeout((()=>{o||n||e.classList.add("fade")}),2e3))):(e.classList.remove("show"),n||e.classList.add("fade"))})),e.addEventListener("click",(function(){n=!0,e.classList.add("show"),e.classList.remove("fade"),e.style.transform="translateY(-5px)",window.scrollTo({top:0,behavior:"smooth"});const t=setInterval((function(){0===window.scrollY&&(n=!1,i(),window.scrollY<=window.innerHeight&&(e.classList.remove("show"),e.classList.add("fade")),clearInterval(t))}),100);setTimeout((()=>{clearInterval(t),n=!1,i()}),1e4)})),e.addEventListener("touchend",(function(){setTimeout(i,300)}))}!function(){const e=null===localStorage.getItem("darkMode")||"true"===localStorage.getItem("darkMode");null===localStorage.getItem("darkMode")&&localStorage.setItem("darkMode","true"),e&&document.documentElement.classList.add("dark-mode")}(),document.addEventListener("DOMContentLoaded",(function(){const e=2025,t=(new Date).getFullYear(),o=t>e?`2025-${t}`:e.toString();document.getElementById("year").textContent=o,initTheme(),initMobileMenu(),document.querySelector(".filter-btn")&&initProjectFilters(),document.getElementById("contactForm")&&initContactForm(),initAnimations(),initBackToTop(),initEmailFeature(),function e(){if("undefined"!=typeof emailjs)try{emailjs.init({publicKey:"bu9KzKbiZezJcbpeX",limitRate:{throttle:5e3}})}catch(t){setTimeout(e,2e3)}else setTimeout(e,1e3)}()}));