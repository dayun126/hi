function initTheme(){const t=document.querySelector(".theme-toggle"),e=document.querySelector(".theme-toggle i");t.removeAttribute("title");"true"===localStorage.getItem("darkMode")?(document.body.classList.add("dark-mode"),document.documentElement.classList.add("dark-mode"),e.classList.remove("fa-sun"),e.classList.add("fa-moon"),t.setAttribute("data-tooltip","切换为浅色模式")):(document.body.classList.remove("dark-mode"),document.documentElement.classList.remove("dark-mode"),e.classList.remove("fa-moon"),e.classList.add("fa-sun"),t.setAttribute("data-tooltip","切换为深色模式")),t.addEventListener("click",(function(){document.body.classList.toggle("dark-mode"),document.documentElement.classList.toggle("dark-mode"),document.body.classList.contains("dark-mode")?(e.classList.remove("fa-sun"),e.classList.add("fa-moon"),localStorage.setItem("darkMode","true"),t.setAttribute("data-tooltip","切换为浅色模式")):(e.classList.remove("fa-moon"),e.classList.add("fa-sun"),localStorage.setItem("darkMode","false"),t.setAttribute("data-tooltip","切换为深色模式"))}))}function initMobileMenu(){const t=document.querySelector(".menu-btn"),e=document.querySelector(".nav-links");t.addEventListener("click",(function(){e.classList.toggle("show");document.querySelectorAll(".bar").forEach((t=>t.classList.toggle("active")))}));document.querySelectorAll(".nav-links a").forEach((t=>{t.addEventListener("click",(function(){e.classList.remove("show");document.querySelectorAll(".bar").forEach((t=>t.classList.remove("active")))}))}))}function initProjectFilters(){const t=document.querySelectorAll(".filter-btn"),e=document.querySelectorAll(".card[data-category]");t.forEach((o=>{o.addEventListener("click",(function(){t.forEach((t=>t.classList.remove("active"))),this.classList.add("active");const o=this.getAttribute("data-filter");e.forEach((t=>{"all"===o||t.getAttribute("data-category")===o?t.style.display="block":t.style.display="none"}))}))}))}function initContactForm(){const t=document.getElementById("contactForm"),e=t.querySelector('button[type="submit"]'),o="form_submissions";t.addEventListener("submit",(function(n){if(n.preventDefault(),!function(){const t=Date.now(),e=JSON.parse(localStorage.getItem(o))||{count:0,firstSubmissionTime:null};return e.firstSubmissionTime&&t-e.firstSubmissionTime>864e5?(localStorage.removeItem(o),!0):e.count<3}())return void alert("太频繁啦！请24小时后再试\n或直接联系：dayuncloud@qq.com");const s=e.textContent;e.textContent="发送中...",e.disabled=!0,emailjs.sendForm("service_0b5rod8","template_uofl1lf",this).then((()=>{!function(){const t=Date.now(),e=JSON.parse(localStorage.getItem(o))||{count:0,firstSubmissionTime:null};e.firstSubmissionTime||(e.firstSubmissionTime=t),e.count++,localStorage.setItem(o,JSON.stringify(e))}(),alert("消息已发送成功！我会尽快回复您。"),t.reset()})).catch((t=>{alert("发送失败，请直接联系邮箱：dayuncloud@qq.com")})).finally((()=>{e.textContent=s,e.disabled=!1}))}))}function initAnimations(){function t(t){const e=t.getBoundingClientRect();return e.top<=(window.innerHeight||document.documentElement.clientHeight)&&e.bottom>=0}const e=document.querySelectorAll("[data-aos]");e.forEach((e=>{t(e)&&e.classList.add("aos-animate")})),window.addEventListener("scroll",(function(){e.forEach((e=>{t(e)&&e.classList.add("aos-animate")}))}))}function initEmailFeature(){const t=document.querySelectorAll(".email-icon"),e=document.querySelector(".email-tooltip"),o=document.querySelector(".copy-btn");document.querySelector(".email-address").textContent;t.forEach((t=>{t.addEventListener("click",(function(o){o.preventDefault(),e.classList.toggle("show"),document.addEventListener("click",(function o(n){e.contains(n.target)||t.contains(n.target)||(e.classList.remove("show"),document.removeEventListener("click",o))}))}))})),o.addEventListener("click",(()=>{const t=document.querySelector(".email-address").textContent;navigator.clipboard.writeText(t).then((()=>{o.textContent="已复制",o.classList.add("copied"),setTimeout((()=>{o.textContent="复制",o.classList.remove("copied")}),2e3)})).catch((()=>{alert("复制失败，请手动选择文本复制")}))}))}function initBackToTop(){const t=document.querySelector(".back-to-top");let e,o=!1,n=!1;function s(){t.style.transform="",t.style.boxShadow=""}t.querySelector("i");t.addEventListener("mouseenter",(function(){o=!0,t.classList.remove("fade")})),t.addEventListener("mouseleave",(function(){o=!1,s(),window.scrollY>window.innerHeight&&(clearTimeout(e),e=setTimeout((()=>{o||n||t.classList.add("fade")}),2e3))})),window.addEventListener("scroll",(function(){window.scrollY>window.innerHeight?(t.classList.add("show"),t.classList.remove("fade"),o||n||(clearTimeout(e),e=setTimeout((()=>{o||n||t.classList.add("fade")}),2e3))):(t.classList.remove("show"),n||t.classList.add("fade"))})),t.addEventListener("click",(function(){n=!0,t.classList.add("show"),t.classList.remove("fade"),t.style.transform="translateY(-5px)",window.scrollTo({top:0,behavior:"smooth"});const e=setInterval((function(){0===window.scrollY&&(n=!1,s(),window.scrollY<=window.innerHeight&&(t.classList.remove("show"),t.classList.add("fade")),clearInterval(e))}),100);setTimeout((()=>{clearInterval(e),n=!1,s()}),1e4)})),t.addEventListener("touchend",(function(){setTimeout(s,300)}))}!function(){const t=null===localStorage.getItem("darkMode")||"true"===localStorage.getItem("darkMode");null===localStorage.getItem("darkMode")&&localStorage.setItem("darkMode","true"),t&&document.documentElement.classList.add("dark-mode")}(),document.addEventListener("DOMContentLoaded",(function(){const t=2025,e=(new Date).getFullYear(),o=e>t?`2025-${e}`:t.toString();document.getElementById("year").textContent=o,initTheme(),initMobileMenu(),document.querySelector(".filter-btn")&&initProjectFilters(),document.getElementById("contactForm")&&initContactForm(),initAnimations(),initBackToTop(),initEmailFeature(),emailjs.init("bu9KzKbiZezJcbpeX")}));